# 📘 **SPECIFICATION.md — テニスコート予約アプリ仕様書（v1.3）**

更新日：2025-12-22

作成者：T Yossy

---

# 1. **概要**

本アプリは、テニスコートの予約管理、参加表明、抽選期間リマインド、

および施設名・ニックネーム入力補助を行う、Google Sheets ベースの予約管理ツールである。

カレンダー形式で直感的に操作でき、

チームの調整業務を自動化・簡素化することを目的とする。

---

# 2. **目的**

* テニスコートの予約調整を効率化し、情報の抜け漏れを防ぐ
* チームメンバーの参加状況を一元管理する
* 抽選期間の開始・終了を自動的に案内し、毎月の競争を防ぐ
* 入力補助により、誤記・名称ゆれを防止しメンテナンス性を高める
* Google Drive / Google Sheets を活用し、クラウド環境で安全に管理する

---

# 3. **全体機能一覧**

| 機能カテゴリ       | 内容                                                                        |
| ------------------ | --------------------------------------------------------------------------- |
| 予約管理（CRUD）   | 日付・時間帯・施設名・作成者・メッセージ登録/編集/削除、完了自動化          |
| 参加表明           | 参加/不参加/検討中 の選択、コメント（1件、改行可）、参加者一覧表示          |
| 抽選期間リマインド | 毎月/毎週/毎年 の繰り返し設定、固定文言メッセージ複数登録、トップに常時表示 |
| オートコンプリート | 施設名、ニックネーム候補の入力補助、過去履歴から推奨候補生成                |
| カレンダー表示     | 月間カレンダー、予約状況色分け（確保/抽選中/中止/完了）                     |
| Google Drive 連携  | Sheetsへの読み書き、複数シート（reservations / lottery_periods）管理        |
| 将来拡張予定       | リスト表示（予約一覧＋参加状況）、検索/フィルタ、開発環境＋本番環境分離     |

---

# 4. **データ定義（Google Sheets）**

---

## 4.1 **reservations シート**

| カラム名     | 型           | 内容                         |
| ------------ | ------------ | ---------------------------- |
| id           | string       | UUID（自動生成）             |
| date         | date         | 開始日                       |
| time         | string       | 開始時刻                     |
| end_time     | string       | 終了時刻                     |
| location     | string       | 施設名（オートコンプリート） |
| created_by   | string       | 作成者（ニックネーム）       |
| participants | list[string] | 参加者一覧                   |
| absent       | list[string] | 不参加者一覧                 |
| consider     | list[string] | 検討中一覧                   |
| message      | string       | メッセージ（任意、改行可）   |
| status       | string       | 確保 / 抽選中 / 中止 / 完了  |
| created_at   | datetime     | 作成日時                     |

---

## 4.2 **lottery_periods シート（抽選期間リマインド）**

| カラム名  | 型            | 内容                           |
| --------- | ------------- | ------------------------------ |
| id        | string        | UUID                           |
| frequency | string        | 毎月 / 毎年 / 毎週             |
| month     | int / null    | 毎年の場合のみ                 |
| start_day | int / null    | 毎年/毎月：開始日              |
| end_day   | int / null    | 毎年/毎月：終了日              |
| weekday   | string / null | 毎週：対象曜日                 |
| messages  | list[string]  | 表示する固定メッセージ（複数） |

---

# 5. **画面構成**



| 画面エリア               | 内容                                                                                                         |
| :----------------------- | :----------------------------------------------------------------------------------------------------------- |
| **ヘッダー**       | アプリタイトル、抽選期間リマインダー通知                                                                     |
| **メイン表示切替** | **「📅 カレンダー」 / 「📋 予約リスト」 のタブ切り替え**                                               |
| **カレンダータブ** | 月表示カレンダー。日付クリックで新規登録、イベントクリックで詳細表示。                                       |
| **リストタブ**     | 予約データの表形式表示（日時・施設・状態・参加者・メモ）。行選択で詳細表示。                                 |
| **詳細・編集画面** | **ポップアップ（モーダルダイアログ）で表示。** `<br>` 画面遷移せず、その場で登録・編集・削除を行う。 |


# 6. **機能詳細仕様**

---

## 6.1 **予約管理（CRUD）**

### ● 登録

* 日付・時間帯・施設名・作成者・メッセージを入力
* オートコンプリートで候補表示
* 保存時に UUID 発行

### ● 編集

* 全項目編集可能
* メッセージは改行をそのまま保存
* 改行 → `<br>` 変換は行わない（そのまま表示）

### ● 自動完了

* 予約日＋終了時刻 < 現在時刻 → status="完了"

### ● 削除

* 必ず確認ダイアログを表示

---

## 6.2 **参加表明機能**

* 表明は **参加 / 保留 / 削除 の3種**
* 1ユーザー1コメント（改行可）
* 参加者一覧・保留者一覧を表示

● タブ切り替え

* 「カレンダー」と「リスト」をタブで切り替える。
* 切り替え時、選択状態（編集中などの状態）はリセットする。

### ● 新規登録・編集のフロー（ポップアップ化）

* **従来:** 画面下部にフォームを表示 → 画面がガタつく、カレンダーがリセットされる問題あり。
* **v1.3以降:** **「モーダルダイアログ（ポップアップ）」** を採用。
  * 日付やイベントをクリックすると、画面中央にウィンドウが浮き上がる。
  * 「登録/反映」ボタンを押すと、データを保存してダイアログを閉じ、画面を更新する。
  * これにより、背景のカレンダーやリストの表示位置が維持される。


## 6.3 **抽選期間リマインド（新機能）**

### ● 表示条件

以下のいずれかに該当したら通知欄に表示：

* 毎月：
  * 今日の日付が start_day〜end_day の間
* 毎年：
  * 今日が指定された月＋日レンジに該当
* 毎週：
  * 今日の曜日と一致

### ● メッセージ仕様

* messages: list[string]
* 改行なしの短文を複数並べて表示

### ● 通知欄の設計

* トップ画面上部に常時表示
* 抽選期間に該当するメッセージのみ表示



## 6.3 パフォーマンス要件（★新規追加）

### ● データ処理の高速化

* **事前加工キャッシュ:**
  * Google Sheetsから取得したデータは、即座に表示用データ（曜日付き日付、結合済み時間文字列、参加者名リストなど）に加工してからメモリにキャッシュする。
  * これにより、ボタン操作ごとの再計算を防ぎ、体感速度を向上させる。
* **リマインダーのキャッシュ:**
  * 頻繁に変更されないリマインダー情報は、長期間（1時間程度）キャッシュし、API通信回数を削減する。

---

## 6.4 **オートコンプリート**

対象：

* 施設名
* 作成者（ニックネーム）

候補は以下の情報から自動生成：

* 過去の予約
* 過去の参加表明
* 固定リスト（必要なら将来追加）

---

## 6.5 **Google Drive / Google Sheets連携**

### ● 使用API

* Google Drive API
* Google Sheets API

### ● 連携仕様

* 読み取り：毎回最新を取得
* 書き込み：更新時に該当行を上書き
* CSV は使用しない
* 認証：OAuth（credentials.json または service account）

---

# 7. **予約ステータスと色定義**

| ステータス | 色 | 説明           |
| ---------- | -- | -------------- |
| 確保       | 緑 | コート確保済み |
| 抽選中     | 黄 | 抽選申請中     |
| 中止       | 赤 | 実施なし       |
| 完了       | 灰 | 過去の予約     |

---

# 8. **通知仕様**

* トップ画面最上段に「お知らせ」欄表示
* 抽選期間に該当するメッセージのリストを表示
* 関連リンクがある場合はリンク表示（将来追加）

---

# 9. **将来拡張**

* 予約一覧のテーブル表示
* 参加状況を一覧化
* 検索＋フィルタ
* Google Calendar 連携
* 開発環境／本番環境の設定切り替え
* バックアップ（複数バージョン保存）

---

# 10. **更新履歴**

| 日付       | 内容                                                       | 担当 |
| ---------- | ---------------------------------------------------------- | ---- |
| 2025-11-18 | v1.2更新（抽選期間、参加コメント、オートコンプリート統合） |      |
